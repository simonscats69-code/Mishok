# 🎮 Мишок Лысый - Telegram Bot

## 📋 Оглавление
1. [🚀 Быстрый старт](#быстрый-старт)
2. [✨ Возможности](#возможности)
3. [🎮 Команды](#команды)
4. [📊 Системы бота](#системы-бота)
5. [💾 Сохранение данных](#сохранение-данных)
6. [⚙️ Настройка](#настройка)
7. [🛠️ Технические детали](#технические-детали)
8. [📁 Структура проекта](#структура-проекта)
9. [🐛 Устранение неполадок](#устранение-неполадок)
10. [🤝 Вклад в проект](#вклад-в-проект)
11. [📄 Лицензия](#лицензия)

---

## 🚀 Быстрый старт

### Требования
- Python 3.8 или выше
- Telegram Bot Token от [@BotFather](https://t.me/botfather)

### Локальная установка

1. **Клонируйте репозиторий**
```bash
git clone <ваш-репозиторий>
cd mishok-bot
```

2. **Установите зависимости**
```bash
pip install -r requirements.txt
```

3. **Настройте бота**
   - Получите токен у [@BotFather](https://t.me/botfather)
   - Создайте файл `.env` в корне проекта:
   ```env
   BOT_TOKEN=ваш_токен_бота_здесь
   ADMIN_ID=ваш_telegram_id_здесь
   ```
   - (Опционально) Заполните `config.py` если не используете .env

4. **Запустите бота**
```bash
python app.py
```

---

## ✨ Возможности

### 🎯 Основные функции
- **Система шлёпков** с уникальными реакциями
- **Уровневая система** (1-1000+ уровней)
- **Детальная статистика** по игрокам и чатам
- **Топы рейтингов** глобальные и по чатам
- **Inline-кнопки** для удобного взаимодействия
- **Автосохранение** каждые 5 минут

### 📊 Аналитика
- Сравнение с другими игроками
- Любимое время для шлёпков
- Подробная статистика активности

### 💬 Особенности для чатов
- Статистика чата
- Система голосований
- Приветствие новых участников
- Топ игроков чата

### ⚙️ Администрирование
- Панель администратора
- Создание бэкапов
- Проверка целостности данных
- Очистка системы

---

## 🎮 Команды

### 🏠 Основные команды (для всех)
| Команда | Описание | Пример |
|---------|----------|--------|
| `/start` | Начало работы с ботом | `/start` |
| `/help` | Помощь по командам | `/help` |
| `/mishok` | Информация о Мишке | `/mishok` |

### 👊 Система шлёпков
| Команда | Описание | Пример |
|---------|----------|--------|
| `/shlep` | Шлёпнуть Мишка | `/shlep` |
| `👊 Шлёпнуть Мишка` | Шлёпнуть (кнопка) | - |

### 📊 Статистика
| Команда | Описание | Пример |
|---------|----------|--------|
| `/stats` | Глобальная статистика | `/stats` |
| `/level` | Твой уровень и прогресс | `/level` |
| `/my_stats` | Детальная статистика | `/my_stats` |
| `📊 Статистика` | Статистика (кнопка) | - |
| `🎯 Уровень` | Уровень (кнопка) | - |
| `📈 Моя статистика` | Моя статистика (кнопка) | - |

### 💬 Команды для чатов
| Команда | Описание | Пример |
|---------|----------|--------|
| `/chat_stats` | Статистика текущего чата | `/chat_stats` |
| `/chat_top` | Топ игроков чата | `/chat_top` |
| `/vote` | Создать голосование | `/vote Кого шлёпнуть?` |
| `/vote_info` | Активные голосования | `/vote_info` |

### ⚙️ Системные команды
| Команда | Описание | Пример |
|---------|----------|--------|
| `/storage` | Информация о хранилище | `/storage` |
| `/check_data` | Проверка целостности данных | `/check_data` |
| `/data_info` | Информация о файле данных | `/data_info` |
| `/check_paths` | Проверка путей данных | `/check_paths` |

### 🔧 Административные команды (только ADMIN_ID)
| Команда | Описание | Пример |
|---------|----------|--------|
| `/admin` | Панель администратора | `/admin` |
| `/backup` | Создать резервную копию | `/backup` |
| `/repair` | Восстановить структуру данных | `/repair` |

---

## 📊 Системы бота

### 🎯 Уровневая система
- **1 уровень** = 10 шлёпков
- **Урон**: увеличивается с каждым уровнем
- **Титулы**: уникальные названия для каждого уровня
- **Прогресс-бар**: визуальное отображение прогресса

**Пример расчета урона:**
- Уровень 1: 10-25 урона
- Уровень 50: 25-50 урона
- Уровень 100: 50-100+ урона

### 🏆 Титулы по уровням:
- **1-4**: 🌱 ПОЛНЫЙ ДОХЛЯК
- **5-9**: 👊 ЗЕЛЁНЫЙ САЛАГ
- **10-19**: 🔥 УВЕРЕННЫЙ НОВИЧОК
- **20-49**: ⭐ ПРОФЕССИОНАЛ
- **50-99**: 💎 МАГИСТР ШЛЁПКОВ
- **100-149**: 👑 ВЕЛИКИЙ ПОВЕЛИТЕЛЬ
- **150-199**: 🌟 ЛЕГЕНДАРНЫЙ ИМПЕРАТОР
- **200-249**: 🔥 ЦАРЬ ВСЕХ ШЛЁПКОВ
- **250-299**: ⚡ БОЖЕСТВЕННЫЙ ВЛАСТЕЛИН
- **300-349**: 🌠 ПОВЕЛИТЕЛЬ ТЫСЯЧИ МИРОВ
- **350-399**: ⭐ ГАЛАКТИЧЕСКИЙ ИМПЕРАТОР
- **400-449**: 💎 ЗВЁЗДНЫЙ МОНАРХ
- **450-499**: 👑 НЕБЕСНЫЙ ПАТРИАРХ
- **500-549**: 🌟 ВЕРХОВНЫЙ БОГ ШЛЁПКОВ
- **550-599**: 🔥 МИРОТВОРЕЦ ВСЕЛЕННОЙ
- **600-649**: ⚡ ПРЕВОСХОДНЫЙ БОГО-ЦАРЬ
- **650-699**: 🌠 КОСМИЧЕСКИЙ ДЕМИУРГ
- **700-749**: ⭐ ВЕЧНЫЙ ИМПЕРАТОР
- **750-799**: 💎 БОЖЕСТВЕННЫЙ АРХИТЕКТОР
- **800-849**: 👑 ВЛАСТЕЛИН ВСЕХ ИЗМЕРЕНИЙ
- **850-899**: 🌟 ХРАНИТЕЛЬ ГАЛАКТИКИ
- **900-949**: 🔥 БЕССМЕРТНЫЙ ТИТАН
- **950-999**: ⚡ АБСОЛЮТНЫЙ ПОВЕЛИТЕЛЬ
- **1000+**: 🌌 ВСЕЛЕНСКИЙ ШЛЁПКО-БОГ

### 🗳️ Система голосований
- **Создание**: `/vote [вопрос]`
- **Длительность**: 5 минут (настраивается)
- **Результаты**: автоматическое подведение
- **Управление**: кнопки "За" и "Против"

### ⚙️ Админ-панель (`/admin`)
- **🧹 Очистка**: удаление логов, временных файлов, старых бэкапов
- **📊 Статистика**: детальная статистика пользователей
- **💾 Бэкап**: создание резервных копий
- **🔧 Исправление**: восстановление структуры данных
- **🩺 Здоровье**: проверка состояния системы

---

## 💾 Сохранение данных

### 📂 Структура хранения
```
mishok-bot/
├── app.py
├── bot.py
├── config.py
├── database.py
├── data/          # ← ПАПКА ДЛЯ ДАННЫХ
│   ├── mishok_data.json      # ← основные данные
│   ├── votes.json            # ← данные голосований
│   └── backups/              # ← резервные копии
├── .gitignore     # ← игнорирует папку data/
└── requirements.txt
```

### 🔄 Автосохранение
- **Каждый шлёпок** → мгновенное сохранение
- **Автобэкапы** → при каждом изменении данных
- **Резервные копии** → при каждом запуске создаётся бэкап

### 🛡️ Защита данных
1. **Безопасная запись** - через временные файлы
2. **Восстановление** - из резервных копий при ошибках
3. **Логирование** - все операции записываются в лог
4. **Проверка целостности** - валидация данных при загрузке

---

## ⚙️ Настройка

### Файл config.py
```python
import os
from dotenv import load_dotenv

load_dotenv()

# Основные настройки
BOT_TOKEN = os.getenv("BOT_TOKEN", "")
ADMIN_ID = int(os.getenv("ADMIN_ID", "0"))

# Пути к данным
DATA_PATH = os.getenv("DATA_PATH", "data/mishok_bot")
DATA_FILE = os.path.join(BASE_DIR, DATA_PATH, "mishok_data.json")
VOTES_FILE = os.path.join(BASE_DIR, DATA_PATH, "votes.json")
BACKUP_PATH = os.path.join(BASE_DIR, DATA_PATH, "backups")

# Настройки кэша
CACHE_ENABLED = os.getenv("CACHE_ENABLED", "true").lower() == "true"
CACHE_TTL_SECONDS = int(os.getenv("CACHE_TTL_SECONDS", "300"))

# Настройки голосований
CHAT_VOTE_DURATION = int(os.getenv("CHAT_VOTE_DURATION", "300"))

# Настройки бэкапов
BACKUP_ENABLED = os.getenv("BACKUP_ENABLED", "true").lower() == "true"
BACKUP_RETENTION_DAYS = int(os.getenv("BACKUP_RETENTION_DAYS", "7"))

# Реакции Мишка (80+ уникальных реакций)
MISHOK_REACTIONS = [
    "🤯 Ай-яй-яй! Кажется, я увидел своих предков!",
    "💀 Ой, а кости черепа всегда так звенели?",
    # ... 80+ реакций
]

# Описание бота
MISHOK_INTRO = """👴 *Мишок Лысый — бот для шлёпков!*
..."""
```

### Файл requirements.txt
```txt
python-telegram-bot[job-queue]==21.7
python-dotenv==1.0.0
aiohttp==3.9.1
pytz==2023.3.post1
APScheduler==3.10.4
```

---

## 🛠️ Технические детали

### Архитектура
```
┌─────────────────┐
│   Telegram API  │
└────────┬────────┘
         │
┌────────▼────────┐
│  app.py (точка  │
│     входа)      │
└────────┬────────┘
         │
┌────────▼────────┐
│   bot.py (основ-│
│   ная логика)   │
└────────┬────────┘
         │
┌────────▼────────┐    ┌─────────────────┐
│   database.py   │◄──►│  data/ (файлы)  │
└────────┬────────┘    └─────────────────┘
         │
┌────────▼────────┐    ┌─────────────────┐
│   Модули:       │    │  Внешние API:   │
│  - keyboard.py  │    │  - Telegram     │
│  - statistics.py│    └─────────────────┘
│  - cache.py     │
│  - utils.py     │
└─────────────────┘
```

### База данных
- **Формат**: JSON (легковесный, читаемый)
- **Структура**:
  ```json
  {
    "global_stats": {...},
    "users": {...},
    "chats": {...},
    "timestamps": {...},
    "records": [...],
    "updated_at": "2024-01-20T12:00:00"
  }
  ```
- **Оптимизация**: Автосохранение, бэкапы, валидация

### Кэширование
- **Время жизни**: 5 минут (настраивается)
- **Типы данных**: статистика, данные пользователей
- **Автоочистка**: устаревшие записи удаляются автоматически

---

## 📁 Структура проекта

```
mishok-bot/
├── app.py              # Точка входа
├── bot.py              # Основная логика бота
├── config.py           # Конфигурация
├── database.py         # Работа с данными
├── cache.py            # Кэширование
├── keyboard.py         # Клавиатуры
├── statistics.py       # Статистика
├── utils.py            # Вспомогательные функции
├── fix_data.py         # Исправление данных
├── migrate_data.py     # Миграция данных
├── requirements.txt    # Зависимости
├── README.md           # Документация
├── .env.example        # Пример переменных окружения
├── .gitignore          # Игнорируемые файлы
└── data/               # ДАННЫЕ (создаётся автоматически)
    ├── mishok_data.json
    ├── votes.json
    └── backups/
```

---

## 🐛 Устранение неполадок

### Проблема: Данные не сохраняются
**Решение:**
1. Проверьте права на запись в папку `data/`
2. Убедитесь, что папка `data/` существует
3. Используйте команду `/check_data` для проверки целостности

### Проблема: Бот не запускается
**Решение:**
1. Проверьте `BOT_TOKEN` в переменных окружения
2. Убедитесь, что все зависимости установлены
3. Проверьте логи: `python app.py`

### Проблема: Кнопки не работают
**Решение:**
1. Убедитесь, что используется последняя версия `bot.py`
2. Проверьте обработчики callback в коде
3. Убедитесь, что бот имеет нужные разрешения

### Проблема: Ошибки импорта
**Решение:**
```bash
# Переустановите зависимости
pip uninstall -r requirements.txt -y
pip install -r requirements.txt
```

---

## 🤝 Вклад в проект

### Как помочь?
1. **Сообщайте об ошибках** через Issues
2. **Предлагайте улучшения** через Pull Requests
3. **Делитесь идеями** для новых функций

### Руководство по разработке
1. Форкните репозиторий
2. Создайте ветку для своей функции
3. Закоммитьте изменения
4. Откройте Pull Request

---

## 📄 Лицензия

Этот проект распространяется под лицензией MIT.

---

## 🎉 Благодарности

Спасибо всем, кто тестирует бота, предлагает улучшения и помогает в разработке!

---

**Версия**: 2.0  
**Последнее обновление**: 2024  
**Статус**: Активно развивается

---

> 💡 **Совет**: Регулярно создавайте бэкапы данных командой `/backup` (только для администраторов)
